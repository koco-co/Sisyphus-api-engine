name: "WebSocket实时推送示例"
description: "演示通过YAML配置启用WebSocket实时推送功能"

config:
  name: "WebSocket测试配置"
  timeout: 30

  # WebSocket配置 - 启用实时推送
  websocket:
    enabled: true              # 启用WebSocket服务器
    host: "localhost"          # 服务器地址
    port: 8765                 # 服务器端口
    send_progress: true        # 发送进度更新事件
    send_logs: true            # 发送日志事件
    send_variables: false      # 发送变量更新事件（生产环境建议关闭）

steps:
  # 步骤1: GET请求测试
  - name: "获取HTTP Bin测试数据"
    type: request
    method: GET
    url: "https://httpbin.org/get"
    headers:
      Accept: "application/json"
    validations:
      - type: status_code
        expect: 200
        description: "验证HTTP状态码为200"
      - type: eq
        path: "$.headers.Host"
        expect: "httpbin.org"
        description: "验证请求头"
    extractors:
      - name: origin_ip
        type: jsonpath
        path: "$.origin"

  # 步骤2: POST请求测试
  - name: "发送POST请求"
    type: request
    method: POST
    url: "https://httpbin.org/post"
    headers:
      Content-Type: "application/json"
    body:
      message: "Hello from Sisyphus with WebSocket!"
      timestamp: "${int(1000000)}"
    validations:
      - type: status_code
        expect: 200
        description: "验证HTTP状态码为200"
      - type: eq
        path: "$.json.message"
        expect: "Hello from Sisyphus with WebSocket!"
        description: "验证返回的消息内容"

  # 步骤3: 延迟测试（展示进度更新）
  - name: "等待2秒"
    type: wait
    seconds: 2

  # 步骤4: 带重试的请求（展示重试事件）
  - name: "测试随机延迟接口"
    type: request
    method: GET
    url: "https://httpbin.org/delay/1"
    timeout: 5
    validations:
      - type: status_code
        expect: 200
        description: "验证HTTP状态码为200"

  # 步骤5: 使用提取的变量
  - name: "使用之前提取的IP地址"
    type: request
    method: GET
    url: "https://httpbin.org/headers"
    validations:
      - type: status_code
        expect: 200
    extractors:
      - name: user_agent
        type: jsonpath
        path: "$.headers['User-Agent']"
