# Sisyphus API Engine ç°ä»£åŒ–é‡æ„ä»»åŠ¡æ¸…å•

## ğŸ“‹ æ€»è§ˆ

æœ¬æ–‡æ¡£è®°å½•äº†å°† Sisyphus API Engine é¡¹ç›®ä» conda + ä¼ ç»Ÿå·¥å…·é“¾è¿ç§»åˆ° uv + ç°ä»£åŒ–å·¥å…·é“¾çš„å®Œæ•´ä»»åŠ¡æ¸…å•ã€‚

**ç›®æ ‡**:
- ä» conda è¿ç§»åˆ° uv åŒ…ç®¡ç†
- åº”ç”¨ ruffã€Pyrightã€pre-commitã€rich ç­‰ç°ä»£åŒ–å·¥å…·
- æ›´æ–°æ‰€æœ‰æ³¨é‡Šä¸ºä¸­æ–‡
- å‡çº§ä¾èµ–åˆ°æœ€æ–°ç¨³å®šç‰ˆæœ¬
- Python 3.14ï¼ˆå½“å‰æœ€æ–°ç¨³å®šç‰ˆï¼‰

---

## ğŸ¯ ç¬¬ä¸€é˜¶æ®µï¼šç¯å¢ƒä¸é…ç½®è¿ç§»

### 1.1 åˆ›å»º uv ç¯å¢ƒ
- [ ] ä½¿ç”¨ uv åˆ›å»º Python 3.14 è™šæ‹Ÿç¯å¢ƒ
- [ ] éªŒè¯ Python ç‰ˆæœ¬
- [ ] åˆ é™¤æ—§çš„ conda ç¯å¢ƒç›¸å…³æ–‡ä»¶

### 1.2 æ›´æ–° pyproject.toml
- [ ] æ›´æ–° `requires-python` ä¸º ">=3.12"
- [ ] ç§»é™¤ blackã€isortã€flake8ã€mypyã€pylint é…ç½®
- [ ] æ·»åŠ  ruff é…ç½®ï¼ˆå‚è€ƒåšå®¢é…ç½®ï¼‰
- [ ] æ·»åŠ  Pyright é…ç½®ï¼ˆstrict modeï¼‰
- [ ] æ›´æ–°æ‰€æœ‰ä¸»è¦ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬
- [ ] æ›´æ–°å¼€å‘ä¾èµ–ï¼ˆç§»é™¤æ—§å·¥å…·ï¼Œæ·»åŠ æ–°å·¥å…·ï¼‰

### 1.3 åˆ›å»º .pre-commit-config.yaml
- [ ] åˆ›å»º pre-commit é…ç½®æ–‡ä»¶
- [ ] é…ç½® pre-commit-hooksï¼ˆåŸºç¡€æ£€æŸ¥ï¼‰
- [ ] é…ç½® ruffï¼ˆformat + lintï¼‰
- [ ] é…ç½® pyrightï¼ˆæœ¬åœ°é’©å­ï¼‰
- [ ] é…ç½® trufflehogï¼ˆå¯†é’¥æ‰«æï¼‰

### 1.4 åˆ›å»º pyrightconfig.json
- [ ] åˆ›å»º Pyright é…ç½®æ–‡ä»¶
- [ ] è®¾ç½® strict mode
- [ ] é…ç½® include/exclude è·¯å¾„
- [ ] é…ç½®æŠ¥å‘Šé€‰é¡¹

---

## ğŸ¨ ç¬¬äºŒé˜¶æ®µï¼šä»£ç è´¨é‡å·¥å…·é›†æˆ

### 2.1 Ruff é…ç½®
- [ ] é…ç½® ruff formatï¼ˆå•å¼•å·ã€88å­—ç¬¦è¡Œå®½ï¼‰
- [ ] é…ç½® ruff lint è§„åˆ™é›†ï¼ˆE, W, F, I, UP, C4, TID, ARG, PTHï¼‰
- [ ] é…ç½® per-file-ignoresï¼ˆtests/, scripts/ï¼‰
- [ ] é…ç½® isort å‚æ•°
- [ ] è¿è¡Œ `ruff format .` æ ¼å¼åŒ–æ‰€æœ‰ä»£ç 
- [ ] è¿è¡Œ `ruff check . --fix` è‡ªåŠ¨ä¿®å¤é—®é¢˜

### 2.2 Pyright é…ç½®
- [ ] å®‰è£… pyright
- [ ] è¿è¡Œ `pyright .` æ£€æŸ¥ç±»å‹
- [ ] ä¿®å¤ç±»å‹é”™è¯¯ï¼ˆå¦‚æœå¯å¿«é€Ÿä¿®å¤ï¼‰
- [ ] è®°å½•éœ€è¦æ‰‹åŠ¨å¤„ç†çš„ç±»å‹é—®é¢˜

### 2.3 Pre-commit é›†æˆ
- [ ] å®‰è£… pre-commitï¼š`uv pip install pre-commit`
- [ ] å®‰è£…é’©å­ï¼š`pre-commit install`
- [ ] è¿è¡Œ `pre-commit run --all-files` éªŒè¯é…ç½®
- [ ] ä¿®å¤æ‰€æœ‰é’©å­å¤±è´¥çš„é—®é¢˜

---

## ğŸ“ ç¬¬ä¸‰é˜¶æ®µï¼šæ³¨é‡Šä¸­æ–‡åŒ–

### 3.1 æ ¸å¿ƒæ¨¡å—æ³¨é‡Š
- [ ] `apirun/core/models.py` - æ•°æ®æ¨¡å‹
- [ ] `apirun/core/variable_manager.py` - å˜é‡ç®¡ç†å™¨
- [ ] `apirun/core/template_functions.py` - æ¨¡æ¿å‡½æ•°
- [ ] `apirun/core/retry.py` - é‡è¯•ç®¡ç†å™¨
- [ ] `apirun/core/condition_evaluator.py` - æ¡ä»¶è¯„ä¼°å™¨
- [ ] `apirun/core/dependency_analyzer.py` - ä¾èµ–åˆ†æå™¨
- [ ] `apirun/core/global_config_manager.py` - å…¨å±€é…ç½®ç®¡ç†å™¨

### 3.2 è§£æå™¨æ³¨é‡Š
- [ ] `apirun/parser/v2_yaml_parser.py` - YAML è§£æå™¨

### 3.3 æ‰§è¡Œå™¨æ³¨é‡Š
- [ ] `apirun/executor/step_executor.py` - æ­¥éª¤æ‰§è¡Œå™¨åŸºç±»
- [ ] `apirun/executor/api_executor.py` - API æ‰§è¡Œå™¨
- [ ] `apirun/executor/database_executor.py` - æ•°æ®åº“æ‰§è¡Œå™¨
- [ ] `apirun/executor/wait_executor.py` - ç­‰å¾…æ‰§è¡Œå™¨
- [ ] `apirun/executor/loop_executor.py` - å¾ªç¯æ‰§è¡Œå™¨
- [ ] `apirun/executor/concurrent_executor.py` - å¹¶å‘æ‰§è¡Œå™¨
- [ ] `apirun/executor/poll_executor.py` - è½®è¯¢æ‰§è¡Œå™¨
- [ ] `apirun/executor/script_executor.py` - è„šæœ¬æ‰§è¡Œå™¨
- [ ] `apirun/executor/test_case_executor.py` - æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå™¨

### 3.4 éªŒè¯å™¨æ³¨é‡Š
- [ ] `apirun/validation/engine.py` - éªŒè¯å¼•æ“
- [ ] `apirun/validation/comparators.py` - æ¯”è¾ƒå™¨
- [ ] `apirun/validator/yaml_validator.py` - YAML éªŒè¯å™¨

### 3.5 æå–å™¨æ³¨é‡Š
- [ ] `apirun/extractor/jsonpath_extractor.py` - JSONPath æå–å™¨
- [ ] `apirun/extractor/regex_extractor.py` - æ­£åˆ™æå–å™¨
- [ ] `apirun/extractor/header_extractor.py` - Header æå–å™¨
- [ ] `apirun/extractor/cookie_extractor.py` - Cookie æå–å™¨
- [ ] `apirun/extractor/extractor_factory.py` - æå–å™¨å·¥å‚

### 3.6 ç»“æœå¯¼å‡ºå™¨æ³¨é‡Š
- [ ] `apirun/result/json_exporter.py` - JSON å¯¼å‡ºå™¨
- [ ] `apirun/result/junit_exporter.py` - JUnit å¯¼å‡ºå™¨
- [ ] `apirun/result/html_exporter.py` - HTML å¯¼å‡ºå™¨
- [ ] `apirun/result/allure_exporter.py` - Allure å¯¼å‡ºå™¨

### 3.7 æ•°æ®é©±åŠ¨æ³¨é‡Š
- [ ] `apirun/data_driven/data_source.py` - æ•°æ®æº
- [ ] `apirun/data_driven/iterator.py` - æ•°æ®è¿­ä»£å™¨

### 3.8 WebSocket æ¨¡å—æ³¨é‡Š
- [ ] `apirun/websocket/server.py` - WebSocket æœåŠ¡å™¨
- [ ] `apirun/websocket/broadcaster.py` - å¹¿æ’­å™¨
- [ ] `apirun/websocket/notifier.py` - é€šçŸ¥å™¨
- [ ] `apirun/websocket/progress.py` - è¿›åº¦äº‹ä»¶
- [ ] `apirun/websocket/events.py` - äº‹ä»¶å®šä¹‰

### 3.9 Mock æ¨¡å—æ³¨é‡Š
- [ ] `apirun/mock/server.py` - Mock æœåŠ¡å™¨
- [ ] `apirun/mock/models.py` - Mock æ¨¡å‹

### 3.10 å·¥å…·æ¨¡å—æ³¨é‡Š
- [ ] `apirun/utils/logger.py` - æ—¥å¿—å·¥å…·
- [ ] `apirun/utils/console_output.py` - æ§åˆ¶å°è¾“å‡º
- [ ] `apirun/utils/error_utils.py` - é”™è¯¯å·¥å…·
- [ ] `apirun/utils/template.py` - æ¨¡æ¿å·¥å…·
- [ ] `apirun/utils/performance.py` - æ€§èƒ½å·¥å…·
- [ ] `apirun/utils/hooks.py` - é’©å­å·¥å…·
- [ ] `apirun/utils/enhanced_jsonpath.py` - å¢å¼º JSONPath
- [ ] `apirun/utils/json_optimized.py` - ä¼˜åŒ– JSON

### 3.11 CLI æ³¨é‡Š
- [ ] `apirun/cli.py` - å‘½ä»¤è¡Œæ¥å£
- [ ] `apirun/cli_help_i18n.py` - å¸®åŠ©ä¿¡æ¯å›½é™…åŒ–

---

## ğŸ¨ ç¬¬å››é˜¶æ®µï¼šRich åº“é›†æˆ

### 4.1 æ—¥å¿—ç³»ç»Ÿæ”¹é€ 
- [ ] é‡æ„ `apirun/utils/logger.py` ä½¿ç”¨ rich.console
- [ ] é‡æ„ `apirun/utils/console_output.py` ä½¿ç”¨ rich è¾“å‡º
- [ ] æ·»åŠ è‰²å½©æ–¹æ¡ˆï¼ˆæˆåŠŸ/å¤±è´¥/è­¦å‘Š/ä¿¡æ¯ï¼‰
- [ ] æ·»åŠ è¡¨æ ¼è¾“å‡ºï¼ˆç”¨äºæµ‹è¯•ç»“æœæ±‡æ€»ï¼‰
- [ ] æ·»åŠ è¿›åº¦æ¡ï¼ˆç”¨äºé•¿æ—¶é—´æ“ä½œï¼‰
- [ ] ç¾åŒ– traceback æ˜¾ç¤º

### 4.2 CLI è¾“å‡ºæ”¹é€ 
- [ ] æ›´æ–°æˆåŠŸæ¶ˆæ¯ä½¿ç”¨ `[green]`
- [ ] æ›´æ–°é”™è¯¯æ¶ˆæ¯ä½¿ç”¨ `[bold red]`
- [ ] æ›´æ–°è­¦å‘Šæ¶ˆæ¯ä½¿ç”¨ `[yellow]`
- [ ] æ›´æ–°ä¿¡æ¯æ¶ˆæ¯ä½¿ç”¨ `[cyan]`
- [ ] æ·»åŠ é¢æ¿ï¼ˆPanelï¼‰ç”¨äºé‡è¦ä¿¡æ¯
- [ ] æ·»åŠ è¯­æ³•é«˜äº®ï¼ˆç”¨äº YAML/JSON ä»£ç ï¼‰

---

## ğŸ“¦ ç¬¬äº”é˜¶æ®µï¼šä¾èµ–æ›´æ–°

### 5.1 æ ¸å¿ƒä¾èµ–æ›´æ–°
- [ ] Jinja2: 3.0.0 â†’ æœ€æ–°ï¼ˆ3.1.xï¼‰
- [ ] jsonpath-ng: 1.6.0 â†’ æœ€æ–°
- [ ] PyYAML: 6.0 â†’ æœ€æ–°ï¼ˆ6.0.2+ï¼‰
- [ ] pyyaml-include: 1.3 â†’ æœ€æ–°
- [ ] requests: 2.28.0 â†’ æœ€æ–°ï¼ˆ2.32.xï¼‰
- [ ] httpx: 0.24.0 â†’ æœ€æ–°ï¼ˆ0.28.xï¼‰
- [ ] PyMySQL: 1.0.0 â†’ æœ€æ–°ï¼ˆ1.1.xï¼‰
- [ ] SQLAlchemy: 2.0.0 â†’ æœ€æ–°ï¼ˆ2.0.x æœ€æ–°ï¼‰
- [ ] Flask: 3.0.0 â†’ æœ€æ–°ï¼ˆ3.1.xï¼‰
- [ ] websockets: 12.0 â†’ æœ€æ–°
- [ ] rich: 13.0.0 â†’ æœ€æ–°
- [ ] typing-extensions: 4.5.0 â†’ æœ€æ–°
- [ ] python-dateutil: 2.8.0 â†’ æœ€æ–°

### 5.2 å¼€å‘ä¾èµ–æ›´æ–°
- [ ] ç§»é™¤ï¼šblack, isort, flake8, mypy, pylint
- [ ] æ·»åŠ ï¼šruffï¼ˆæœ€æ–°ï¼‰
- [ ] æ·»åŠ ï¼špyrightï¼ˆæœ€æ–°ï¼‰
- [ ] æ·»åŠ ï¼špre-commitï¼ˆæœ€æ–°ï¼‰
- [ ] ä¿ç•™ï¼špytest, pytest-cov, pytest-asyncioï¼ˆæ›´æ–°åˆ°æœ€æ–°ï¼‰

### 5.3 åŒæ­¥ç¯å¢ƒ
- [ ] è¿è¡Œ `uv sync` åŒæ­¥ä¾èµ–
- [ ] éªŒè¯æ‰€æœ‰ä¾èµ–æ­£ç¡®å®‰è£…
- [ ] è¿è¡Œ `uv pip freeze` æ£€æŸ¥ç‰ˆæœ¬

---

## ğŸ§ª ç¬¬å…­é˜¶æ®µï¼šæµ‹è¯•ä¸éªŒè¯

### 6.1 å•å…ƒæµ‹è¯•
- [ ] è¿è¡Œ `pytest tests/core/` - æ ¸å¿ƒæ¨¡å—æµ‹è¯•
- [ ] è¿è¡Œ `pytest tests/parser/` - è§£æå™¨æµ‹è¯•
- [ ] è¿è¡Œ `pytest tests/executor/` - æ‰§è¡Œå™¨æµ‹è¯•
- [ ] è¿è¡Œ `pytest tests/validation/` - éªŒè¯å™¨æµ‹è¯•
- [ ] è¿è¡Œ `pytest tests/extractor/` - æå–å™¨æµ‹è¯•
- [ ] è¿è¡Œ `pytest tests/utils/` - å·¥å…·æµ‹è¯•

### 6.2 é›†æˆæµ‹è¯•
- [ ] è¿è¡Œ `pytest tests/integration/` - ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] è¿è¡Œ `pytest tests/mock/` - Mock æœåŠ¡æµ‹è¯•
- [ ] è¿è¡Œæ‰€æœ‰ YAML ç¤ºä¾‹æµ‹è¯•
- [ ] éªŒè¯ Allure æŠ¥å‘Šç”Ÿæˆ
- [ ] éªŒè¯ JUnit æŠ¥å‘Šç”Ÿæˆ
- [ ] éªŒè¯ HTML æŠ¥å‘Šç”Ÿæˆ

### 6.3 è¦†ç›–ç‡æµ‹è¯•
- [ ] è¿è¡Œ `pytest --cov=apirun --cov-report=html`
- [ ] æ£€æŸ¥è¦†ç›–ç‡æ˜¯å¦è¾¾åˆ° 80%
- [ ] è¯†åˆ«æœªè¦†ç›–çš„ä»£ç åŒºåŸŸ
- [ ] è¡¥å……æµ‹è¯•ç”¨ä¾‹ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰

### 6.4 ç±»å‹æ£€æŸ¥
- [ ] è¿è¡Œ `pyright .`
- [ ] ä¿®å¤æ‰€æœ‰ç±»å‹é”™è¯¯
- [ ] ç¡®ä¿ strict mode é€šè¿‡

### 6.5 ä»£ç è´¨é‡æ£€æŸ¥
- [ ] è¿è¡Œ `ruff format . --check` éªŒè¯æ ¼å¼
- [ ] è¿è¡Œ `ruff check .` éªŒè¯ lint è§„åˆ™
- [ ] è¿è¡Œ `pre-commit run --all-files` éªŒè¯é’©å­

---

## ğŸ“š ç¬¬ä¸ƒé˜¶æ®µï¼šæ–‡æ¡£æ›´æ–°

### 7.1 README.md æ›´æ–°
- [ ] æ›´æ–°å®‰è£…è¯´æ˜ï¼ˆuv æ›¿ä»£ conda/pipï¼‰
- [ ] æ›´æ–°å¼€å‘ç¯å¢ƒæ­å»ºæ­¥éª¤
- [ ] æ›´æ–°ä¾èµ–ç®¡ç†è¯´æ˜
- [ ] æ›´æ–°ä»£ç è´¨é‡å·¥å…·è¯´æ˜ï¼ˆruff + pyrightï¼‰
- [ ] æ›´æ–°æµ‹è¯•å‘½ä»¤è¯´æ˜
- [ ] æ·»åŠ  pre-commit ä½¿ç”¨è¯´æ˜
- [ ] æ›´æ–° Python ç‰ˆæœ¬è¦æ±‚ï¼ˆ3.12+ï¼‰

### 7.2 CLAUDE.md æ›´æ–°
- [ ] æ›´æ–°å¸¸ç”¨å‘½ä»¤ï¼ˆuv ç›¸å…³ï¼‰
- [ ] æ›´æ–°ä»£ç è´¨é‡æ£€æŸ¥å‘½ä»¤ï¼ˆruff æ›¿ä»£ black/isort/flake8ï¼‰
- [ ] æ›´æ–°ç±»å‹æ£€æŸ¥å‘½ä»¤ï¼ˆpyright æ›¿ä»£ mypyï¼‰
- [ ] æ›´æ–° Git hooks è¯´æ˜ï¼ˆpre-commitï¼‰
- [ ] æ·»åŠ  rich ä½¿ç”¨ç¤ºä¾‹
- [ ] æ›´æ–°å¼€å‘æŒ‡å—ä¸­çš„å·¥å…·é“¾

### 7.3 é…ç½®æ–‡ä»¶æ–‡æ¡£
- [ ] åˆ›å»ºæˆ–æ›´æ–° `.vscode/settings.json`ï¼ˆæ¨èé…ç½®ï¼‰
- [ ] åˆ›å»ºæˆ–æ›´æ–° `.editorconfig`ï¼ˆç¼–è¾‘å™¨é…ç½®ï¼‰
- [ ] æ›´æ–° `CONTRIBUTING.md`ï¼ˆè´¡çŒ®æŒ‡å—ï¼Œå¦‚æœ‰ï¼‰
- [ ] æ›´æ–° `CHANGELOG.md`ï¼ˆæ›´æ–°æ—¥å¿—ï¼‰

---

## âœ… ç¬¬å…«é˜¶æ®µï¼šæ”¶å°¾å·¥ä½œ

### 8.1 æ¸…ç†å·¥ä½œ
- [ ] åˆ é™¤ `.mypy_cache`ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- [ ] åˆ é™¤æ—§çš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰
- [ ] æ›´æ–° `.gitignore`ï¼ˆæ·»åŠ  uv ç›¸å…³å¿½ç•¥ï¼‰
- [ ] æ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œç¼“å­˜

### 8.2 Git æäº¤
- [ ] è¿è¡Œ pre-commit æœ€ç»ˆæ£€æŸ¥
- [ ] æäº¤æ‰€æœ‰æ›´æ”¹
- [ ] åˆ›å»ºæ¸…æ™°çš„ commit message
- [ ] æ¨é€åˆ°è¿œç¨‹ä»“åº“

### 8.3 å‘å¸ƒå‡†å¤‡
- [ ] æ›´æ–°ç‰ˆæœ¬å·ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰
- [ ] åˆ›å»º Release Notes
- [ ] æ ‡è®°æ–°ç‰ˆæœ¬
- [ ] åˆ›å»º GitHub Release

---

## ğŸ“Š è¿›åº¦è¿½è¸ª

**æ€»ä»»åŠ¡æ•°**: 200+

**å½“å‰è¿›åº¦**:
- ç¬¬ä¸€é˜¶æ®µ: 0/7
- ç¬¬äºŒé˜¶æ®µ: 0/13
- ç¬¬ä¸‰é˜¶æ®µ: 0/50+
- ç¬¬å››é˜¶æ®µ: 0/12
- ç¬¬äº”é˜¶æ®µ: 0/18
- ç¬¬å…­é˜¶æ®µ: 0/18
- ç¬¬ä¸ƒé˜¶æ®µ: 0/10
- ç¬¬å…«é˜¶æ®µ: 0/6

**é¢„è®¡å®Œæˆæ—¶é—´**: éœ€è¦æ ¹æ®å®é™…è¿›å±•è¯„ä¼°

---

## ğŸ” å…³é”®æ³¨æ„äº‹é¡¹

1. **å¤‡ä»½**: åœ¨å¼€å§‹ä¹‹å‰ï¼Œç¡®ä¿å·²å¤‡ä»½å½“å‰å·¥ä½œçŠ¶æ€æˆ–åˆ›å»ºæ–°åˆ†æ”¯
2. **æ¸è¿›å¼**: å»ºè®®åˆ†é˜¶æ®µå®Œæˆï¼Œæ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡Œæµ‹è¯•
3. **å…¼å®¹æ€§**: Python 3.14 æ˜¯è¾ƒæ–°ç‰ˆæœ¬ï¼Œæ³¨æ„ä¾èµ–å…¼å®¹æ€§
4. **ç±»å‹å®‰å…¨**: Pyright strict mode å¯èƒ½ä¼šæš´éœ²å¤§é‡ç±»å‹é—®é¢˜ï¼Œéœ€è¦é€æ­¥ä¿®å¤
5. **å›¢é˜Ÿåä½œ**: ç¡®ä¿å›¢é˜Ÿæˆå‘˜äº†è§£æ–°çš„å·¥å…·é“¾å’Œå·¥ä½œæµ

---

## ğŸ“š å‚è€ƒèµ„æº

- [uv å®˜æ–¹æ–‡æ¡£](https://github.com/astral-sh/uv)
- [Ruff å®˜æ–¹æ–‡æ¡£](https://docs.astral.sh/ruff/)
- [Pyright å®˜æ–¹æ–‡æ¡£](https://github.com/microsoft/pyright)
- [pre-commit å®˜æ–¹æ–‡æ¡£](https://pre-commit.com/)
- [rich å®˜æ–¹æ–‡æ¡£](https://rich.readthedocs.io/)
- [åšå®¢æ–‡ç« ](https://koco-co.github.io/posts/7af74e55/)

---

**åˆ›å»ºæ—¶é—´**: 2026-02-09
**æœ€åæ›´æ–°**: 2026-02-09
