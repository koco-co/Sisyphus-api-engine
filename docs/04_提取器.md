# æå–å™¨

> å­¦ä¹ å¦‚ä½•ä» API å“åº”ä¸­æå–æ•°æ®å¹¶ä¿å­˜ä¸ºå˜é‡ã€‚

---

## ğŸ“– æ¦‚è¿°

æå–å™¨ï¼ˆExtractorsï¼‰ç”¨äºä» API å“åº”ä¸­æå–æ•°æ®å¹¶ä¿å­˜ä¸ºå˜é‡ï¼Œä¾›åç»­æ­¥éª¤ä½¿ç”¨ã€‚æ”¯æŒå¤šç§æå–æ–¹å¼ï¼šJSONPathã€æ­£åˆ™è¡¨è¾¾å¼ã€å“åº”å¤´ã€Cookie ç­‰ã€‚

---

## ğŸ¯ å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬ç« åï¼Œä½ å°†èƒ½å¤Ÿï¼š
- ä½¿ç”¨ JSONPath æå– JSON æ•°æ®
- ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–æ–‡æœ¬
- æå–å“åº”å¤´å’Œ Cookie
- é…ç½®æå–å¤±è´¥æ—¶çš„é»˜è®¤å€¼

---

## âš™ï¸ YAML å…³é”®å­—å‚è€ƒ

| å…³é”®å­— | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | æè¿° |
|-------|------|------|--------|------|
| name | string | âœ… | - | å˜é‡åç§° |
| type | string | âŒ | jsonpath | æå–ç±»å‹ |
| path | string | âœ… | - | æå–è·¯å¾„/è¡¨è¾¾å¼ |
| index | int | âŒ | 0 | ç»“æœç´¢å¼• |
| default | any | âŒ | null | é»˜è®¤å€¼ |

### æå–ç±»å‹

| ç±»å‹ | æè¿° |
|------|------|
| `jsonpath` | ä» JSON å“åº”ä½“æå– |
| `regex` | æ­£åˆ™è¡¨è¾¾å¼æå– |
| `header` | ä»å“åº”å¤´æå– |
| `cookie` | ä» Cookie æå– |

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šJSONPath æå–

```yaml
extractors:
  # æå–å•ä¸ªå­—æ®µ
  - name: user_id
    type: jsonpath
    path: "$.data.user.id"

  # æå–åµŒå¥—æ•°æ®
  - name: first_item_name
    type: jsonpath
    path: "$.data.items[0].name"

  # æå–æ‰€æœ‰åŒ¹é…é¡¹
  - name: all_ids
    type: jsonpath
    path: "$.data.items[*].id"
    index: -1  # -1 è¡¨ç¤ºè¿”å›å…¨éƒ¨

  # å¸¦é»˜è®¤å€¼
  - name: optional_field
    type: jsonpath
    path: "$.data.optional"
    default: "not_found"
```

### ç¤ºä¾‹2ï¼šæ­£åˆ™è¡¨è¾¾å¼æå–

```yaml
extractors:
  # åŸºæœ¬æ­£åˆ™æå–
  - name: order_id
    type: regex
    path: "Order ID: (\\d+)"
    index: 1  # æ•è·ç»„ç´¢å¼•

  # ä½¿ç”¨ pattern/group è¯­æ³•
  - name: amount
    type: regex
    pattern: "Total: \\$([\\d.]+)"
    group: 1

  # æå–å¤šä¸ªå€¼
  - name: phone
    type: regex
    path: "\\d{3}-\\d{4}-\\d{4}"
    index: 0  # ç¬¬ä¸€ä¸ªåŒ¹é…
```

### ç¤ºä¾‹3ï¼šå“åº”å¤´å’Œ Cookie æå–

```yaml
extractors:
  # æå–å“åº”å¤´
  - name: content_type
    type: header
    path: "Content-Type"

  - name: request_id
    type: header
    path: "X-Request-ID"

  # æå– Cookie
  - name: session_token
    type: cookie
    path: "session_id"

  - name: auth_cookie
    type: cookie
    path: "auth_token"
```

### ç¤ºä¾‹4ï¼šå®Œæ•´æå–æµç¨‹

```yaml
steps:
  - name: "ç™»å½•"
    method: POST
    url: "${base_url}/auth/login"
    body:
      username: "admin"
      password: "password"
    extractors:
      - name: access_token
        type: jsonpath
        path: "$.data.token"
      - name: refresh_token
        type: jsonpath
        path: "$.data.refresh_token"
      - name: user_id
        type: jsonpath
        path: "$.data.user.id"
      - name: session_id
        type: header
        path: "X-Session-ID"

  - name: "è·å–ç”¨æˆ·ä¿¡æ¯"
    method: GET
    url: "${base_url}/users/${user_id}"
    headers:
      Authorization: "Bearer ${access_token}"
      X-Session-ID: "${session_id}"
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **JSONPath æ•°ç»„ç´¢å¼•**ï¼šä» 0 å¼€å§‹ï¼Œ`[0]` æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ 
2. **æ­£åˆ™æ•è·ç»„**ï¼šç´¢å¼• 0 æ˜¯å®Œæ•´åŒ¹é…ï¼Œ1 å¼€å§‹æ˜¯æ•è·ç»„
3. **æå–å¤±è´¥**ï¼šå»ºè®®è®¾ç½® default é¿å…åç»­æ­¥éª¤å‡ºé”™

---

## ğŸ”— ç›¸å…³èµ„æº

- [ä¸Šä¸€ç« ï¼šéªŒè¯æ–­è¨€](./03_éªŒè¯æ–­è¨€.md)
- [ä¸‹ä¸€ç« ï¼šç¯å¢ƒé…ç½®](./05_ç¯å¢ƒé…ç½®.md)
- [ç¤ºä¾‹æ–‡ä»¶](../examples/05_å˜é‡æå–.yaml)
