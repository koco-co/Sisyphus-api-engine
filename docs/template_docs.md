# 文档模板规范 (Template)

> **模板说明**: 本文档是所有功能详细文档的编写模板，创建新文档时请严格遵循此格式。
> **适用范围**: 所有 `docs/<序号>_<阶段名称>.md` 文档

---

## 文档命名规范

### 格式
```
<两位序号>_<阶段名称>.md
```

### 示例
- `01_第一阶段_核心数据模型.md`
- `02_第二阶段_配置管理.md`
- `03_第三阶段_变量系统.md`

---

## 文档结构模板

```markdown
# <阶段编号>: <阶段功能名称>

> **阶段目标**: <一句话描述本阶段的学习目标>
> **涉及文件**: <列出本阶段涉及的核心文件>
> **预计时间**: <可选，填写预计学习时间>
> **前置知识**: <可选，列出需要的前置阶段>

---

## 📋 目录

- [核心概念](#核心概念)
- [数据模型/架构设计](#数据模型架构设计)
- [关键字参考](#关键字参考)
- [使用示例](#使用示例)
- [最佳实践](#最佳实践)
- [常见问题](#常见问题)
- [单元测试](#单元测试)
- [相关文档](#相关文档)

---

## 🎯 核心概念

### 概念1: <概念名称>

**简要说明**: <用一两句话解释这个概念是什么>

**详细说明**:
- <要点1>
- <要点2>
- <要点3>

**代码位置**: `apirun/<module>/<file>.py:<line_number>`

---

### 概念2: <概念名称>

**简要说明**: ...

---

## 🏗️ 数据模型/架构设计

> **说明**: 本节根据内容选择合适的标题，数据模型阶段用"数据模型"，其他阶段用"架构设计"

### 模型1: <模型名称>

**作用**: <这个模型的作用是什么>

**定义位置**: `apirun/<module>/<file>.py:<line_number>`

**字段说明**:

| 字段名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| field1 | str | 是 | - | 字段说明 |
| field2 | int | 否 | 30 | 字段说明 |
| field3 | Dict[str, Any] | 否 | {} | 字段说明 |

**使用示例**:
```yaml
# YAML 示例
field1: "值1"
field2: 100
field3:
  key: "value"
```

---

## 📖 关键字参考

### <功能分类1>

#### 关键字1: `<keyword>`

**作用**: <这个关键字的作用>

**使用位置**: <YAML中的位置，如 config.profiles, steps[*].type 等>

**类型**: <string/number/object/array/boolean>

**必填**: <是/否>

**默认值**: <如果不填的默认值>

**取值范围**:
- `value1`: 说明
- `value2`: 说明

**详细说明**:
<详细说明该关键字的使用方法、注意事项等>

**示例**:
```yaml
# 基本用法
keyword: "value"

# 高级用法
keyword:
  option1: "value1"
  option2: "value2"
```

**注意事项**:
- <注意点1>
- <注意点2>

**代码实现**: `apirun/<module>/<file>.py:<line_number>`

---

#### 关键字2: `<keyword>`

...

---

## 💡 使用示例

### 示例1: <场景名称>

**场景描述**: <描述这个示例的使用场景>

**YAML 完整代码**:
```yaml
name: "示例用例"
description: "示例描述"

config:
  # 配置部分

steps:
  - name: "步骤1"
    # 步骤配置
```

**执行命令**:
```bash
sisyphus --cases examples/yaml/<序号>_<示例名称>.yaml
```

**预期结果**:
<描述执行后的预期结果>

---

### 示例2: <场景名称>

...

---

## 🌟 推荐组合用法

### 组合1: <组合名称>

**使用场景**: <描述这个组合的使用场景>

**YAML 示例**:
```yaml
steps:
  - name: "步骤1"
    keyword1: "value1"
    keyword2: "value2"

  - name: "步骤2"
    depends_on:
      - "步骤1"
    keyword3: "value3"
```

**优势**:
- <优势1>
- <优势2>

---

### 组合2: <组合名称>

...

---

## ⚠️ 最佳实践

### 实践1: <实践名称>

**推荐做法**:
```yaml
# ✅ 好的做法
<好的示例>
```

**不推荐做法**:
```yaml
# ❌ 不好的做法
<不好的示例>
```

**原因**: <解释为什么推荐前者而不推荐后者>

---

### 实践2: <实践名称>

...

---

## ❓ 常见问题

### Q1: <问题描述>

**答案**: <详细解答>

**相关链接**: `docs/<相关文档>.md`

---

### Q2: <问题描述>

...

---

## 🧪 单元测试

### 测试文件位置
```
tests/<module>/test_<file>.py
```

### 测试覆盖范围

| 测试场景 | 测试用例 | 状态 |
|----------|----------|------|
| 正常场景 | test_<scenario>_normal | ✅ |
| 边界场景 | test_<scenario>_boundary | ✅ |
| 异常场景 | test_<scenario>_exception | ✅ |

### 运行测试
```bash
# 运行本阶段所有测试
pytest tests/<module>/ -v

# 运行特定测试文件
pytest tests/<module>/test_<file>.py -v

# 查看测试覆盖率
pytest tests/<module>/ --cov=apirun.<module> --cov-report=html
```

### 测试示例
```python
def test_<function>_normal():
    """测试正常场景."""
    # Arrange
    input_data = {...}

    # Act
    result = <function>(input_data)

    # Assert
    assert result.expected_field == expected_value
```

---

## 📚 相关文档

### 内部文档
- [上一阶段文档](./<上一阶段文档>.md)
- [下一阶段文档](./<下一阶段文档>.md)
- [API-Engine输入协议规范](./API-Engine输入协议规范.md)
- [API-Engine输出协议规范](./API-Engine输出协议规范.md)

### 外部参考
- [相关技术官方文档](<URL>)

### 源码参考
- 核心实现: `apirun/<module>/<file>.py`
- 单元测试: `tests/<module>/test_<file>.py`
- YAML示例: `examples/yaml/<序号>_<示例名称>.yaml`

---

## 📝 更新日志

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|----------|------|
| 1.0.0 | 2026-02-03 | 初始版本 | Claude |

---

**文档维护**: 本文档随代码更新同步维护
```

---

## 特殊章节说明

### 1. 关于"关键字参考"章节

**必须包含的关键字**:
- 本阶段涉及的所有 YAML 关键字
- 每个关键字必须包含：作用、位置、类型、必填、默认值、取值范围、详细说明、示例、注意事项、代码实现位置

**表格格式**:

| 关键字 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| keyword1 | string | 是 | - | 说明 |
| keyword2 | number | 否 | 30 | 说明 |
| keyword3 | boolean | 否 | true | 说明 |

---

### 2. 关于"使用示例"章节

**每个功能至少包含**:
- 1个基础示例（最简单的用法）
- 1-3个进阶示例（展示不同场景）
- 1个完整示例（可运行的完整 YAML）

**示例格式**:
```yaml
# 文件名: examples/yaml/<序号>_<功能>_<场景>.yaml
name: "<功能名称> - <场景>"
description: "<场景描述>"

config:
  # 配置

steps:
  - name: "步骤名称"
    type: <类型>
    # 详细配置
```

---

### 3. 关于"推荐组合用法"章节

**组合场景**:
- 配合验证器使用
- 配合提取器使用
- 配合变量使用
- 配合控制流使用

---

### 4. 关于"单元测试"章节

**必须包含**:
- 测试文件位置
- 测试覆盖范围（表格形式）
- 运行测试命令
- 至少1个测试代码示例

---

## 文档编写检查清单

在发布文档前，请确认以下内容：

### 内容完整性
- [ ] 所有章节都已填写
- [ ] 目录链接正确
- [ ] 代码块语法高亮正确
- [ ] 表格格式正确

### 示例可用性
- [ ] 所有 YAML 示例都可以实际运行
- [ ] 执行命令正确
- [ ] 预期结果描述准确

### 代码引用
- [ ] 所有代码位置引用格式：`apirun/<module>/<file>.py:<line_number>`
- [ ] 行号准确（可用 `grep -n` 查找）
- [ ] 文件路径正确

### 文档链接
- [ ] 相关文档链接有效
- [ ] 内部链接使用相对路径
- [ ] 外部链接可以访问

### 格式规范
- [ ] 标题层级正确（# ## ### ####）
- [ ] 列表格式正确（- 或 1.）
- [ ] 代码块语言标识正确（```yaml ```python ```bash）
- [ ] 表格对齐正确

---

## 文档审查流程

1. **自我审查**: 按照检查清单逐项检查
2. **运行示例**: 执行所有 YAML 示例，确保可运行
3. **运行测试**: 执行单元测试，确保通过
4. **同行审查**: 如有可能，请他人审查
5. **更新发布**: 审查通过后更新并发布

---

**模板版本**: v1.0.0
**最后更新**: 2026-02-03
**维护者**: Sisyphus API Engine Team
