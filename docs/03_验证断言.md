# éªŒè¯æ–­è¨€

> å­¦ä¹ å¦‚ä½•å¯¹ API å“åº”è¿›è¡Œå…¨é¢éªŒè¯ã€‚

---

## ğŸ“– æ¦‚è¿°

éªŒè¯æ–­è¨€ï¼ˆValidationsï¼‰ç”¨äºæ£€æŸ¥ API å“åº”æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚Sisyphus æä¾›ä¸°å¯Œçš„æ¯”è¾ƒå™¨ï¼Œæ”¯æŒçŠ¶æ€ç ã€å“åº”ä½“ã€å“åº”å¤´ç­‰å¤šç»´åº¦éªŒè¯ï¼Œè¿˜æ”¯æŒé€»è¾‘ç»„åˆï¼ˆAND/OR/NOTï¼‰å®ç°å¤æ‚éªŒè¯åœºæ™¯ã€‚

---

## ğŸ¯ å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬ç« åï¼Œä½ å°†èƒ½å¤Ÿï¼š
- ä½¿ç”¨å„ç§æ¯”è¾ƒå™¨éªŒè¯å“åº”æ•°æ®
- ä½¿ç”¨ JSONPath å®šä½å“åº”ä¸­çš„æ•°æ®
- ç»„åˆå¤šä¸ªéªŒè¯è§„åˆ™
- è‡ªå®šä¹‰éªŒè¯é”™è¯¯æ¶ˆæ¯

---

## ğŸ“š æ ¸å¿ƒæ¦‚å¿µ

### æ¯”è¾ƒå™¨ç±»å‹

| æ¯”è¾ƒå™¨ | æè¿° | ç¤ºä¾‹ |
|-------|------|------|
| `eq` | ç­‰äº | `expect: 200` |
| `ne` | ä¸ç­‰äº | `expect: null` |
| `gt` | å¤§äº | `expect: 0` |
| `lt` | å°äº | `expect: 100` |
| `ge` | å¤§äºç­‰äº | `expect: 1` |
| `le` | å°äºç­‰äº | `expect: 10` |
| `contains` | åŒ…å« | `expect: "success"` |
| `not_contains` | ä¸åŒ…å« | `expect: "error"` |
| `regex` | æ­£åˆ™åŒ¹é… | `expect: "\\d+"` |
| `type` | ç±»å‹æ£€æŸ¥ | `expect: "int"` |
| `in_list` | åœ¨åˆ—è¡¨ä¸­ | `expect: [1,2,3]` |
| `length_eq` | é•¿åº¦ç­‰äº | `expect: 5` |
| `status_code` | çŠ¶æ€ç éªŒè¯ | `expect: "200"` |

---

## âš™ï¸ YAML å…³é”®å­—å‚è€ƒ

| å…³é”®å­— | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | æè¿° |
|-------|------|------|--------|------|
| type | string | âŒ | eq | æ¯”è¾ƒå™¨ç±»å‹ |
| path | string | âœ… | - | JSONPath è¡¨è¾¾å¼ |
| expect | any | âœ… | - | æœŸæœ›å€¼ |
| description | string | âŒ | "" | éªŒè¯æè¿° |

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šåŸºç¡€éªŒè¯

```yaml
validations:
  # çŠ¶æ€ç éªŒè¯
  - type: status_code
    path: "$.status_code"
    expect: "200"
    description: "éªŒè¯è¯·æ±‚æˆåŠŸ"

  # å“åº”ä½“å­—æ®µéªŒè¯
  - type: eq
    path: "$.data.status"
    expect: "success"
    description: "éªŒè¯çŠ¶æ€ä¸ºæˆåŠŸ"

  # æ•°å­—æ¯”è¾ƒ
  - type: gt
    path: "$.data.count"
    expect: 0
    description: "éªŒè¯æ•°é‡å¤§äº0"
```

### ç¤ºä¾‹2ï¼šå­—ç¬¦ä¸²éªŒè¯

```yaml
validations:
  # åŒ…å«éªŒè¯
  - type: contains
    path: "$.message"
    expect: "æ“ä½œæˆåŠŸ"

  # æ­£åˆ™åŒ¹é…
  - type: regex
    path: "$.data.email"
    expect: "^[\\w.-]+@[\\w.-]+\\.\\w+$"
    description: "éªŒè¯Emailæ ¼å¼"

  # ä¸åŒ…å«
  - type: not_contains
    path: "$.message"
    expect: "error"
```

### ç¤ºä¾‹3ï¼šç±»å‹å’Œé•¿åº¦éªŒè¯

```yaml
validations:
  # ç±»å‹æ£€æŸ¥
  - type: type
    path: "$.data.id"
    expect: "int"

  - type: type
    path: "$.data.name"
    expect: "str"

  # åˆ—è¡¨é•¿åº¦
  - type: length_eq
    path: "$.data.items"
    expect: 10

  - type: length_gt
    path: "$.data.items"
    expect: 0
```

### ç¤ºä¾‹4ï¼šåˆ—è¡¨éªŒè¯

```yaml
validations:
  # å€¼åœ¨åˆ—è¡¨ä¸­
  - type: in_list
    path: "$.data.status"
    expect: ["pending", "active", "completed"]

  # å€¼ä¸åœ¨åˆ—è¡¨ä¸­
  - type: not_in_list
    path: "$.data.status"
    expect: ["deleted", "banned"]
```

---

## ğŸ”§ é€»è¾‘ç»„åˆ

### AND ç»„åˆï¼ˆæ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³ï¼‰

```yaml
validations:
  - type: and
    conditions:
      - type: gt
        path: "$.data.age"
        expect: 18
      - type: lt
        path: "$.data.age"
        expect: 65
```

### OR ç»„åˆï¼ˆä»»ä¸€æ¡ä»¶æ»¡è¶³ï¼‰

```yaml
validations:
  - type: or
    conditions:
      - type: eq
        path: "$.status"
        expect: "success"
      - type: eq
        path: "$.status"
        expect: "pending"
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **JSONPath è¯­æ³•**ï¼šè·¯å¾„ä»¥ `$.` å¼€å¤´ï¼Œæ•°ç»„ä½¿ç”¨ `[0]` ç´¢å¼•
2. **ç±»å‹åŒ¹é…**ï¼šæ¯”è¾ƒæ—¶æ³¨æ„æ•°æ®ç±»å‹ï¼ˆå­—ç¬¦ä¸² vs æ•°å­—ï¼‰
3. **ç©ºå€¼å¤„ç†**ï¼šä½¿ç”¨ `type: eq` + `expect: null` éªŒè¯ç©ºå€¼

---

## ğŸ”— ç›¸å…³èµ„æº

- [ä¸Šä¸€ç« ï¼šå˜é‡ç³»ç»Ÿ](./02_å˜é‡ç³»ç»Ÿ.md)
- [ä¸‹ä¸€ç« ï¼šæå–å™¨](./04_æå–å™¨.md)
- [ç¤ºä¾‹æ–‡ä»¶](../examples/04_éªŒè¯æ–­è¨€.yaml)
