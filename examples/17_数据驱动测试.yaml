# ==============================================================================
# Sisyphus API Engine - 数据驱动测试
# ==============================================================================
# 功能说明：演示数据驱动测试功能
# - CSV文件数据源
# - JSON文件数据源
# - 内联数据
# ==============================================================================

name: "数据驱动测试"
description: "演示CSV/JSON/内联数据驱动测试"

config:
  name: "测试配置"
  timeout: 60
  profiles:
    prod:
      base_url: "https://httpbin.org"
  # 数据驱动配置
  data_iterations: true  # 启用数据驱动迭代
  variable_prefix: "data_"  # 数据变量前缀
  data_source:
    # 数据源类型：json
    type: json
    # JSON 文件路径
    file_path: "examples/data/test_users.json"
    # 数据键（可选，如果JSON是对象格式）
    data_key: "users"

# ============================================================================
# 测试步骤
# ============================================================================
steps:
  # ----------------------------------------------------------------------------
  # 步骤1: 使用JSON数据源驱动测试
  # 用途：演示使用JSON文件数据进行数据驱动测试
  # 数据源：examples/data/test_users.json中的3条用户数据
  # 变量前缀：data_ (变量名为 data_username, data_email, data_age)
  # ----------------------------------------------------------------------------
  - name: "测试用户数据"
    description: "使用JSON数据源测试多个用户"
    type: request
    method: POST
    url: "${config.profiles.prod.base_url}/post"
    headers:
      Content-Type: "application/json"
    # 使用数据变量（带 data_ 前缀）
    body:
      username: "${data_username}"
      email: "${data_email}"
      age: "${data_age}"
    validations:
      - type: status_code
        path: "$.status_code"
        expect: "200"
        description: "验证状态码为200"
      - type: eq
        path: "$.json.username"
        expect: "${data_username}"
        description: "验证用户名正确"
      - type: eq
        path: "$.json.email"
        expect: "${data_email}"
        description: "验证邮箱正确"
      - type: eq
        path: "$.json.age"
        expect: "${data_age}"
        description: "验证年龄正确"

  # ----------------------------------------------------------------------------
  # 步骤2: 单个用户数据测试
  # 用途：演示不使用数据驱动的普通请求
  # ----------------------------------------------------------------------------
  - name: "单个用户测试"
    description: "不使用数据驱动的单个用户测试"
    type: request
    method: POST
    url: "${config.profiles.prod.base_url}/post"
    headers:
      Content-Type: "application/json"
    body:
      username: "testuser"
      email: "test@example.com"
      age: 28
    validations:
      - type: status_code
        path: "$.status_code"
        expect: "200"
        description: "验证状态码为200"
      - type: eq
        path: "$.json.username"
        expect: "testuser"
        description: "验证用户名正确"

# ============================================================================
# 标签
# ============================================================================
tags:
  - "数据驱动"
  - "data_driven"
  - "参数化测试"

enabled: true
