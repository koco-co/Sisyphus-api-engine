# Sisyphus API Engine - Concurrent Test Example
# 测试并发执行多个 API 请求

name: "并发测试"
description: "测试并发执行多个 HTTP 请求"

config:
  name: "并发测试配置"
  active_profile: "prod"

  profiles:
    prod:
      base_url: "https://httpbin.org"

steps:
  # 并发测试1: 同时执行多个 GET 请求
  - 并发GET请求测试:
      type: concurrent
      max_concurrency: 3
      concurrent_steps:
        - name: "并发请求1"
          type: request
          url: "${config.profiles.prod.base_url}/get?test=1"
          method: GET
          validations:
            - type: status_code
              path: "$.status_code"
              expect: "200"
              description: "验证请求1成功"

        - name: "并发请求2"
          type: request
          url: "${config.profiles.prod.base_url}/get?test=2"
          method: GET
          validations:
            - type: status_code
              path: "$.status_code"
              expect: "200"
              description: "验证请求2成功"

        - name: "并发请求3"
          type: request
          url: "${config.profiles.prod.base_url}/get?test=3"
          method: GET
          validations:
            - type: status_code
              path: "$.status_code"
              expect: "200"
              description: "验证请求3成功"

        - name: "并发请求4"
          type: request
          url: "${config.profiles.prod.base_url}/get?test=4"
          method: GET
          validations:
            - type: status_code
              path: "$.status_code"
              expect: "200"
              description: "验证请求4成功"

        - name: "并发请求5"
          type: request
          url: "${config.profiles.prod.base_url}/get?test=5"
          method: GET
          validations:
            - type: status_code
              path: "$.status_code"
              expect: "200"
              description: "验证请求5成功"

  # 并发测试2: 混合不同类型的请求
  - 并发混合请求测试:
      type: concurrent
      max_concurrency: 2
      concurrent_steps:
        - name: "POST请求"
          type: request
          url: "${config.profiles.prod.base_url}/post"
          method: POST
          headers:
            Content-Type: "application/json"
          body:
            action: "create"
            data: "test"
          validations:
            - type: status_code
              path: "$.status_code"
              expect: "200"
              description: "验证POST请求成功"

        - name: "PUT请求"
          type: request
          url: "${config.profiles.prod.base_url}/put"
          method: PUT
          headers:
            Content-Type: "application/json"
          body:
            action: "update"
            data: "test"
          validations:
            - type: status_code
              path: "$.status_code"
              expect: "200"
              description: "验证PUT请求成功"

        - name: "DELETE请求"
          type: request
          url: "${config.profiles.prod.base_url}/delete"
          method: DELETE
          validations:
            - type: status_code
              path: "$.status_code"
              expect: "200"
              description: "验证DELETE请求成功"

tags:
  - "concurrent"
  - "performance"

enabled: true
