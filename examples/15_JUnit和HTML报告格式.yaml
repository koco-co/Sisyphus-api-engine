name: "JUnit XML 和 HTML 报告测试"
description: "测试 JUnit XML 和 HTML 报告格式导出功能"

config:
  profiles:
    dev:
      base_url: "https://httpbin.org"
      variables:
        api_key: "test_key_123"
    test:
      base_url: "https://httpbin.org"
      variables:
        api_key: "test_key_456"

  active_profile: "dev"

  variables:
    test_user: "testuser"
    test_password: "testpass123"

  timeout: 30

  output:
    path: "test_results.${timestamp}"
    format: "junit"  # 可以是 "json", "csv", "junit", "html"
    include_request: true
    include_response: true
    include_performance: true
    include_variables: true

steps:
  - name: "获取 IP 地址"
    type: request
    method: GET
    url: "${config.profiles.dev.base_url}/ip"
    headers:
      User-Agent: "Sisyphus-API-Engine/1.0"
      Accept: "application/json"
    validations:
      - type: eq
        path: "$.origin"
        expect: null  # 不验证具体值，只验证字段存在
        description: "验证响应包含 origin 字段"
    extractors:
      - name: origin_ip
        type: jsonpath
        path: "$.origin"

  - name: "获取请求头信息"
    type: request
    method: GET
    url: "${config.profiles.dev.base_url}/headers"
    headers:
      User-Agent: "Sisyphus-API-Engine/1.0"
      Custom-Header: "TestValue"
    validations:
      - type: contains
        path: "$.headers"
        expect: "Custom-Header"
        description: "验证自定义请求头被发送"

  - name: "测试延迟响应"
    type: request
    method: GET
    url: "${config.profiles.dev.base_url}/delay/1"
    timeout: 5
    validations:
      - type: eq
        path: "$.delay"
        expect: 1
        description: "验证延迟时间"

  - name: "测试状态码"
    type: request
    method: GET
    url: "${config.profiles.dev.base_url}/status/200"
    validations:
      - type: eq
        path: "$.status_code"
        expect: 200
        description: "验证状态码为 200"

  - name: "测试 POST 请求"
    type: request
    method: POST
    url: "${config.profiles.dev.base_url}/post"
    headers:
      Content-Type: "application/json"
    body:
      username: "${test_user}"
      password: "${test_password}"
      timestamp: "${timestamp}"
    validations:
      - type: eq
        path: "$.json.username"
        expect: "testuser"
        description: "验证用户名正确"
      - type: eq
        path: "$.json.password"
        expect: "testpass123"
        description: "验证密码正确"
    extractors:
      - name: response_url
        type: jsonpath
        path: "$.url"

  - name: "等待测试"
    type: wait
    seconds: 0.5
    description: "简单等待 0.5 秒"

  - name: "测试数据验证（会失败）"
    type: request
    method: GET
    url: "${config.profiles.dev.base_url}/uuid"
    validations:
      - type: eq
        path: "$.uuid"
        expect: "fixed-uuid-12345"
        description: "这个验证会失败，用于测试失败场景"
    skip_if: "${skip_failure_test}"  # 可以通过设置变量跳过

  - name: "获取用户代理"
    type: request
    method: GET
    url: "${config.profiles.dev.base_url}/user-agent"
    validations:
      - type: contains
        path: "$.['user-agent']"
        expect: "Sisyphus"
        description: "验证 User-Agent 包含 Sisyphus"
