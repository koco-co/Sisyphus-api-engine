# ==============================================================================
# Sisyphus API Engine - 验证断言示例
# ==============================================================================
# 配套文档：docs/03_验证断言.md
# 功能说明：演示各种比较器的使用
# ==============================================================================

name: "验证断言完整示例"
description: "演示eq/ne/gt/lt/contains/regex/type等验证方式"

config:
  profiles:
    prod:
      base_url: "https://httpbin.org"
  active_profile: "prod"

steps:
  # 准备测试数据
  - name: "创建测试数据"
    method: POST
    url: "${config.profiles.prod.base_url}/post"
    headers:
      Content-Type: "application/json"
    body:
      user:
        id: 12345
        name: "测试用户"
        email: "test@example.com"
        age: 28
        status: "active"
        score: 95.5
        tags: ["admin", "vip", "test"]
        is_verified: true
    validations:
      # 状态码验证
      - type: status_code
        path: "$.status_code"
        expect: "200"
        description: "验证HTTP状态码"

      # 等于验证 (eq)
      - type: eq
        path: "$.json.user.name"
        expect: "测试用户"
        description: "验证名称完全匹配"

      # 不等于验证 (ne)
      - type: ne
        path: "$.json.user.status"
        expect: "inactive"
        description: "验证状态不是inactive"

      # 大于验证 (gt)
      - type: gt
        path: "$.json.user.age"
        expect: 18
        description: "验证年龄大于18"

      # 小于验证 (lt)
      - type: lt
        path: "$.json.user.age"
        expect: 65
        description: "验证年龄小于65"

      # 大于等于验证 (ge)
      - type: ge
        path: "$.json.user.score"
        expect: 90
        description: "验证分数大于等于90"

      # 小于等于验证 (le)
      - type: le
        path: "$.json.user.score"
        expect: 100
        description: "验证分数小于等于100"

      # 包含验证 (contains)
      - type: contains
        path: "$.json.user.email"
        expect: "@example.com"
        description: "验证邮箱包含域名"

      # 不包含验证 (not_contains)
      - type: not_contains
        path: "$.json.user.email"
        expect: "error"
        description: "验证邮箱不包含error"

      # 正则匹配 (regex)
      - type: regex
        path: "$.json.user.email"
        expect: "^[\\w.-]+@[\\w.-]+\\.\\w+$"
        description: "验证邮箱格式"

      # 类型验证 (type)
      - type: type
        path: "$.json.user.id"
        expect: "int"
        description: "验证ID是整数"

      - type: type
        path: "$.json.user.name"
        expect: "str"
        description: "验证名称是字符串"

      - type: type
        path: "$.json.user.is_verified"
        expect: "bool"
        description: "验证验证状态是布尔值"

      # 列表包含验证 (in_list)
      - type: in_list
        path: "$.json.user.status"
        expect: ["pending", "active", "inactive"]
        description: "验证状态在允许列表中"

      # 长度验证 (length_eq)
      - type: length_eq
        path: "$.json.user.tags"
        expect: 3
        description: "验证标签列表长度"

      # 长度大于 (length_gt)
      - type: length_gt
        path: "$.json.user.tags"
        expect: 0
        description: "验证标签列表不为空"

tags:
  - "验证"
  - "断言"
enabled: true
