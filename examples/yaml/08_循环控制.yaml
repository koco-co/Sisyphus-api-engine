# ==============================================================================
# Sisyphus API Engine - 循环控制示例
# ==============================================================================
# 配套文档：docs/08_循环控制.md
# 功能说明：演示For循环和While循环
# ==============================================================================

name: "循环控制示例"
description: "演示For循环和While循环的使用"

config:
  profiles:
    prod:
      base_url: "https://httpbin.org"
  active_profile: "prod"

steps:
  # For循环示例
  - name: "For循环批量创建"
    description: "循环5次创建数据"
    type: loop
    loop_type: for
    loop_count: 5
    loop_variable: "i"
    loop_steps:
      - name: "创建第${i}条数据"
        method: POST
        url: "${config.profiles.prod.base_url}/post"
        headers:
          Content-Type: "application/json"
        body:
          index: "${i}"
          name: "item_${i}"
          timestamp: "${i}"
        validations:
          - type: status_code
            path: "$.status_code"
            expect: "200"

  # While循环示例（模拟轮询）
  - name: "初始化计数器"
    method: POST
    url: "${config.profiles.prod.base_url}/post"
    body:
      counter: 0
    extractors:
      - name: counter
        type: jsonpath
        path: "$.json.counter"
        default: "0"

  - name: "While循环轮询"
    description: "循环直到条件满足（最多10次）"
    type: loop
    loop_type: for
    loop_count: 3
    loop_variable: "attempt"
    loop_max: 10
    loop_steps:
      - name: "第${attempt}次检查"
        method: GET
        url: "${config.profiles.prod.base_url}/get"
        params:
          attempt: "${attempt}"
        validations:
          - type: status_code
            path: "$.status_code"
            expect: "200"
      - name: "等待1秒"
        type: wait
        seconds: 1

tags:
  - "循环"
  - "批量操作"
enabled: true
