# ==============================================================================
# Sisyphus API Engine - 变量系统示例
# ==============================================================================
# 配套文档：docs/02_变量系统.md
# 功能说明：演示变量定义、引用、提取和模板函数
# ==============================================================================

name: "变量系统完整示例"
description: "演示全局变量、Profile变量、步骤变量和模板函数"

config:
  timeout: 30
  # 全局变量
  variables:
    api_version: "v2"
    debug_mode: true
    max_retries: 3
  
  # 环境配置
  profiles:
    dev:
      base_url: "https://httpbin.org"
      api_key: "dev_key_12345"
    prod:
      base_url: "https://httpbin.org"
      api_key: "prod_key_67890"
  
  active_profile: "dev"

steps:
  # 示例1：使用全局变量和Profile变量
  - name: "使用配置变量"
    description: "演示如何引用config中定义的变量"
    method: GET
    url: "${config.profiles.dev.base_url}/get"
    params:
      version: "${api_version}"
      debug: "${debug_mode}"
    headers:
      X-API-Key: "${config.profiles.dev.api_key}"
    validations:
      - type: status_code
        path: "$.status_code"
        expect: "200"
      - type: eq
        path: "$.args.version"
        expect: "v2"

  # 示例2：从响应提取变量
  - name: "提取UUID变量"
    method: GET
    url: "${config.profiles.dev.base_url}/uuid"
    extractors:
      - name: generated_uuid
        type: jsonpath
        path: "$.uuid"
    validations:
      - type: status_code
        path: "$.status_code"
        expect: "200"

  # 示例3：使用提取的变量
  - name: "使用提取的变量"
    method: POST
    url: "${config.profiles.dev.base_url}/post"
    headers:
      Content-Type: "application/json"
    body:
      request_id: "${generated_uuid}"
      source: "sisyphus_test"
    validations:
      - type: status_code
        path: "$.status_code"
        expect: "200"
      - type: eq
        path: "$.json.request_id"
        expect: "${generated_uuid}"

  # 示例4：嵌套变量和默认值
  - name: "嵌套变量演示"
    method: POST
    url: "${config.profiles.dev.base_url}/post"
    body:
      config_info:
        env: "dev"
        api_key: "${config.profiles.dev.api_key}"
        version: "${api_version}"
      optional_field: "${undefined_var:default_value}"
    validations:
      - type: status_code
        path: "$.status_code"
        expect: "200"

tags:
  - "变量"
  - "模板"
enabled: true
