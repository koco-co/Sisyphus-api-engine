# =============================================================================#
# Sisyphus API Engine - 并行执行优化测试
# =============================================================================#
# 功能说明：演示智能并发执行和依赖分析
# =============================================================================#

name: "并行执行优化测试"
description: "演示并发执行优化和智能依赖分析"

config:
  name: "测试配置"
  timeout: 30
  retry_times: 0

  profiles:
    prod:
      base_url: "https://httpbin.org"

  active_profile: "prod"

steps:
  # ----------------------------------------------------------------------------
  # 测试1: 顺序执行（无优化）
  # ----------------------------------------------------------------------------

  - name: "测试1: 顺序执行"
    description: "演示无依赖时的顺序执行"
    type: request
    method: GET
    url: "https://httpbin.org/get"

  - name: "测试1: 第二步"
    type: request
    method: GET
    url: "https://httpbin.org/status/200"

  - name: "测试1: 第三步"
    type: request
    method: GET
    url: "https://httpbin.org/delay/1"

  # ----------------------------------------------------------------------------
  # 测试2: 手动并发执行（当前方法）
  # ----------------------------------------------------------------------------

  - name: "测试2: 手动并发配置"
    description: "演示手动配置并发执行"
    type: concurrent
    max_concurrency: 3
    concurrent_steps:
      - name: "并发请求1"
        type: request
        method: GET
        url: "https://httpbin.org/get"

      - name: "并发请求2"
        type: request
        method: GET
        url: "https://httpbin.org/headers"

      - name: "并发请求3"
        type: request
        method: GET
        url: "https://httpbin.org/status/200"

  # ----------------------------------------------------------------------------
  # 测试3: 智能依赖分析场景
  # ----------------------------------------------------------------------------

  - name: "测试3: 设置阶段"
    description: "准备测试数据"
    type: script
    script: |
      # 设置变量标记完成状态
      print("设置完成")

  - name: "测试3: 并行测试A"
    type: request
    method: GET
    url: "https://httpbin.org/get"
    depends_on: ["测试3: 设置阶段"]

  - name: "测试3: 并行测试B"
    type: request
    method: GET
    url: "https://httpbin.org/headers"
    depends_on: ["测试3: 设置阶段"]

  - name: "测试3: 并行测试C"
    type: request
    method: GET
    url: "https://httpbin.org/status/200"
    depends_on: ["测试3: 设置阶段"]

  - name: "测试3: 汇总阶段"
    type: script
    script: |
      # 汇总前面三个测试的结果
      count = 0
      print("汇总测试结果")

  # ----------------------------------------------------------------------------
  # 测试4: 复杂依赖场景
  # ----------------------------------------------------------------------------

  - name: "测试4: 初始化"
    type: script
    script: print("初始化完成")

  - name: "测试4: 数据准备A"
    type: request
    method: GET
    url: "https://httpbin.org/get"
    depends_on: ["测试4: 初始化"]

  - name: "测试4: 数据准备B"
    type: request
    method: GET
    url: "https://httpbin.org/headers"
    depends_on: ["测试4: 初始化"]

  - name: "测试4: 数据验证"
    type: request
    method: GET
    url: "https://httpbin.org/status/200"
    depends_on: ["测试4: 数据准备A", "测试4: 数据准备B"]

  # ----------------------------------------------------------------------------
  # 测试5: 性能对比（大量独立请求）
  # ----------------------------------------------------------------------------

  - name: "测试5: 批量请求"
    description: "演示批量独立请求的并发潜力"
    type: concurrent
    max_concurrency: 5
    concurrent_steps:
      - name: "API请求1"
        type: request
        method: GET
        url: "https://httpbin.org/get"

      - name: "API请求2"
        type: request
        method: GET
        url: "https://httpbin.org/headers"

      - name: "API请求3"
        type: request
        method: GET
        url: "https://httpbin.org/status/200"

      - name: "API请求4"
        type: request
        method: GET
        url: "https://httpbin.org/delay/1"

      - name: "API请求5"
        type: request
        method: GET
        url: "https://httpbin.org/user-agent"

# ============================================================================
# 标签
# ============================================================================
tags:
  - "并发"
  - "parallel"
  - "性能"
  - "optimization"

enabled: true
