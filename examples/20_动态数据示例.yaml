name: "动态数据生成示例"
description: "展示如何使用模板函数生成动态数据"

config:
  timeout: 30
  variables:
    # 使用函数生成唯一标识符
    order_id: "ORDER_${date('%Y%m%d')}_${random(1000, 9999)}"
    request_id: "${uuid()}"
    user_id: "${random(10000, 99999)}"
    session_token: "${random_str(32)}"
    test_timestamp: "${timestamp()}"

steps:
  - name: "创建订单（带动态数据）"
    type: request
    method: POST
    url: "https://httpbin.org/post"
    headers:
      X-Request-ID: "${request_id}"
      X-User-ID: "${user_id}"
    body:
      order_id: "${order_id}"
      user_id: "${user_id}"
      timestamp: ${test_timestamp}
      session_token: "${session_token}"
      items:
        - product_id: "PROD_${random(100, 999)}"
          quantity: ${random(1, 5)}
        - product_id: "PROD_${random(100, 999)}"
          quantity: ${random(1, 5)}
    description: "创建订单时使用随机生成数据"
    validations:
      - type: eq
        path: "$.json.order_id"
        description: "验证 order_id 已正确传递"

  - name: "查询订单（带动态 URL 参数）"
    type: request
    method: GET
    url: "https://httpbin.org/get?order_id=${order_id}&user=${user_id}"
    description: "URL 参数中使用动态变量"

  - name: "生成随机文件名"
    type: request
    method: GET
    url: "https://httpbin.org/get"
    description: |
      展示如何生成动态文件名：
      - report_${date('%Y%m%d')}_${uuid()}.txt
      - backup_table_${random()}_${timestamp()}.sql
      - user_${random_str(8)}_${timestamp()}.json

extractors:
  - name: "extract_order_id"
    type: jsonpath
    path: "$.json.order_id"
    description: "提取生成的订单 ID"
